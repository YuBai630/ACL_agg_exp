# 参考论文：《聚合大规模空调负荷的信息物理建模与控制方法\_王永权》首先实现复现。

然后考虑当前空调需要进一步精细化建模为水冷式空调、多联机空调以及传统分散式空调，考虑其在调控时的独特特性，进行建模--设想是改进的 RTP 模型

## 实现本地控制逻辑 (计算迁移概率):

核心思想: 在每个控制周期 (例如 0.5 小时) 开始时，空调负荷需要根据从聚合商接收到的虚拟价格 π* 来确定在本周期内的响应功率 Pa,ij*，然后计算出本周期内 FSM 需要使用的迁移概率率 u0 和 u1，以使得期望功率 Pexp,ij 接近 Pa,ij\* 并保证状态多样性。

实现方法:

需要实现需求曲线 dij(π) 的建模。这个曲线根据当前的室内温度、设定温度范围 ([Tmin,ij, Tmax,ij]) 以及 ETP 模型参数 (A, B, C, D) 来计算关键点 (Pmin,ij, Pset,ij, Pmax,ij)，并由此确定整个曲线。这个过程需要在每个控制周期开始时进行。

根据聚合商广播的虚拟价格 π*，查或计算需求曲线，得到本周期的目标响应功率 Pa,ij* = dij(π\*)。

实现求解 u0 和 u1 的逻辑。论文中指出，需要同时满足 Pexp,ij = Pa,ij\* (式 21) 和补充条件 (式 22) 来确定 u0 和 u1。补充条件通过随机确定 u1 在一个范围内，然后根据式 (21) 和式 (14) 解出 u0。这个求解过程的细节和存在性证明在附录 B [附录 B]。

将计算出的 u0 和 u1 值更新到 FSM 对象中 (update_migration_probabilities 方法)。这些值将在整个控制周期内用于 FSM 的 step 仿真。

## 复现遇到的问题

（1）应该先查看单个聚合商是否能实现需求响应？
（2）再执行多个聚合商的需求响应

# 空调功率优化线性规划求解器

这个项目实现了一个基于线性规划的空调功率优化系统，使用一阶 ETP（Equivalent Thermal Parameter）模型来计算室温变化。

## 问题描述

优化目标：

```
M_{AC}: min_{P_1,...,P_T,T_2^i,...,T_T^i} Σ(t=1 to T) P_t * Δt
```

约束条件：

- 功率约束：`0 ≤ P_t ≤ P_rated`
- 温度约束：`T_min ≤ T_t ≤ T_max`
- 室温变化公式：`T_{t+1}^i = T_{t+1}^out - η P_t R - (T_{t+1}^out - η P_t R - T_t^i) * exp(-Δt/RC)`

## 安装依赖

```bash
pip install -r requirements.txt
```

## 使用方法

### 基本使用

```python
from src.linear_program import ACOptimizer

# 创建优化器
optimizer = ACOptimizer(
    T=24,           # 24小时优化周期
    delta_t=1.0,    # 1小时时间步长
    P_rated=3.0,    # 3kW额定功率
    T_min=20.0,     # 最低温度20°C
    T_max=26.0,     # 最高温度26°C
    eta=0.8,        # 空调效率0.8
    R=2.0,          # 热阻2°C/kW
    C=5.0,          # 热容5kWh/°C
    T_initial=22.0  # 初始室温22°C
)

# 设置室外温度
outdoor_temp = [25, 26, 27, ...]  # 每小时的室外温度
optimizer.set_outdoor_temperature(outdoor_temp)

# 求解优化问题
if optimizer.solve():
    optimizer.print_results()
    optimizer.plot_results()
```

### 运行示例

```bash
cd src
python linear_program.py
```

## 参数说明

- `T`: 优化时间窗口长度（小时）
- `delta_t`: 时间步长（小时）
- `P_rated`: 空调额定功率（kW）
- `T_min`, `T_max`: 室内温度约束范围（°C）
- `eta`: 空调制冷效率
- `R`: 热阻（°C/kW）
- `C`: 热容（kWh/°C）
- `T_initial`: 初始室内温度（°C）

## 输出结果

程序会输出：

1. 每个时间步的最优功率设置
2. 对应的室内温度变化
3. 总能耗和平均功率
4. 可视化图表（功率、室内温度、室外温度）

## 算法特点

1. **线性规划求解**：使用 PuLP 库的 CBC 求解器
2. **一阶 ETP 模型**：准确模拟室温动态变化
3. **约束处理**：同时满足功率和温度约束
4. **能耗最优**：最小化总能耗目标

## 技术细节

室温变化采用一阶 ETP 公式：

```
T_{t+1}^i = (1-e^(-Δt/RC)) * (T_{t+1}^out - η*P_t*R) + e^(-Δt/RC) * T_t^i
```

这个公式考虑了：

- 室外温度影响
- 空调制冷效果
- 建筑物热惯性
